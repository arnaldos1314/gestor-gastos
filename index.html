<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestor de Gastos PRO</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    input, select, textarea { font-size: 16px !important; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Iconos SVG
    const DollarSign = () => <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>;
    const Upload = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
    const Plus = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
    const Trash2 = ({size = 18}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
    const Download = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
    const Check = ({size = 18}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"></polyline></svg>;
    const X = ({size = 18}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
    const Edit2 = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>;
    const FileText = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>;
    const Inbox = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg>;
    const TrendingUp = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>;
    const BarChart = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>;
    const Camera = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>;
    const Table = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"></path></svg>;
    const Settings = ({size = 20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m5.657-13.657l-4.243 4.243m-4.242 4.242l-4.243 4.243m16.97 0l-4.243-4.243m-4.242-4.242l-4.243-4.243"></path></svg>;



    // Categor√≠as predefinidas
    const CATEGORIAS_CLIENTE = [
      'Materiales',
      'Herramientas',
      'Subcontratistas',
      'Permisos/Licencias',
      'Otros'
    ];

    const CATEGORIAS_PROPIAS = [
      'Mano de Obra',
      'Combustible/Transporte',
      'Depreciaci√≥n Herramientas',
      'Seguros',
      'Administrativos',
      'Otros'
    ];

    function GestorGastosPRO() {
      const [clientes, setClientes] = useState([]);
      const [gastos, setGastos] = useState([]);
      const [bandejaEntrada, setBandejaEntrada] = useState([]);
      const [clienteActual, setClienteActual] = useState('');
      const [proyectoActual, setProyectoActual] = useState('');
      const [isProcessing, setIsProcessing] = useState(false);
      const [showAddClient, setShowAddClient] = useState(false);
      const [mostrarBandeja, setMostrarBandeja] = useState(false);
      const [nuevoCliente, setNuevoCliente] = useState({ nombre: '', email: '', telefono: '' });
      const [vistaActual, setVistaActual] = useState('gastos'); // 'gastos' o 'dashboard'
      const [apiKey, setApiKey] = useState('');
      const [showSettings, setShowSettings] = useState(false);
      const [tempApiKey, setTempApiKey] = useState('');
      const fileInputRef = useRef(null);
      const cameraInputRef = useRef(null);
      const fileInputPropioRef = useRef(null);
      const cameraInputPropioRef = useRef(null);
      const inboxInputRef = useRef(null);
      const inboxCameraRef = useRef(null);

      useEffect(() => {
        const datosGuardados = localStorage.getItem('gestorGastosPRO');
        if (datosGuardados) {
          const datos = JSON.parse(datosGuardados);
          setClientes(datos.clientes || []);
          setGastos(datos.gastos || []);
          setBandejaEntrada(datos.bandejaEntrada || []);
        }
        
        // Cargar API Key
        const savedApiKey = localStorage.getItem('claudeApiKey');
        if (savedApiKey) {
          setApiKey(savedApiKey);
        } else {
          // Si no hay API key, mostrar configuraci√≥n
          setShowSettings(true);
        }
      }, []);

      const guardarApiKey = () => {
        if (tempApiKey.trim().startsWith('sk-ant-')) {
          localStorage.setItem('claudeApiKey', tempApiKey.trim());
          setApiKey(tempApiKey.trim());
          setShowSettings(false);
          alert('‚úÖ API Key guardada correctamente');
        } else {
          alert('‚ùå API Key inv√°lida. Debe comenzar con "sk-ant-"');
        }
      };

      const eliminarApiKey = () => {
        if (confirm('¬øEliminar API Key? Tendr√°s que configurarla nuevamente.')) {
          localStorage.removeItem('claudeApiKey');
          setApiKey('');
          setTempApiKey('');
          alert('‚úÖ API Key eliminada');
        }
      };

      useEffect(() => {
        localStorage.setItem('gestorGastosPRO', JSON.stringify({
          clientes,
          gastos,
          bandejaEntrada
        }));
      }, [clientes, gastos, bandejaEntrada]);

      const agregarCliente = () => {
        if (nuevoCliente.nombre.trim()) {
          setClientes([...clientes, { ...nuevoCliente, id: Date.now() }]);
          setNuevoCliente({ nombre: '', email: '', telefono: '' });
          setShowAddClient(false);
        }
      };

      const procesarFactura = async (file, destino = 'asignada', tipoGasto = 'cliente') => {
        if (!apiKey) {
          alert('‚ö†Ô∏è Necesitas configurar tu API Key de Claude primero. Haz clic en el √≠cono de configuraci√≥n ‚öôÔ∏è');
          setShowSettings(true);
          return;
        }
        
        setIsProcessing(true);
        try {
          const base64Data = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(",")[1]);
            reader.onerror = () => reject(new Error("Error al leer archivo"));
            reader.readAsDataURL(file);
          });

          const isPDF = file.type === 'application/pdf';
          const content = isPDF ? [
            { type: "document", source: { type: "base64", media_type: "application/pdf", data: base64Data } },
            { type: "text", text: `Analiza esta factura PDF y extrae en JSON: {"tienda": "nombre", "fecha": "YYYY-MM-DD", "total": n√∫mero, "items": ["item1", "item2"], "numeroFactura": "n√∫mero"}` }
          ] : [
            { type: "image", source: { type: "base64", media_type: file.type, data: base64Data } },
            { type: "text", text: `Analiza esta factura y extrae en JSON: {"tienda": "nombre", "fecha": "YYYY-MM-DD", "total": n√∫mero, "items": ["item1", "item2"], "numeroFactura": "n√∫mero"}` }
          ];

          const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: { 
              "Content-Type": "application/json",
              "x-api-key": apiKey,
              "anthropic-version": "2023-06-01"
            },
            body: JSON.stringify({
              model: "claude-sonnet-4-20250514",
              max_tokens: 1500,
              messages: [{ role: "user", content: content }]
            })
          });

          if (!response.ok) {
            if (response.status === 401) {
              throw new Error("API Key inv√°lida. Verifica tu configuraci√≥n.");
            }
            throw new Error(`Error: ${response.status}`);
          }

          const data = await response.json();
          let responseText = data.content[0].text.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
          const facturaData = JSON.parse(responseText);

          const nuevoGasto = {
            id: Date.now(),
            ...facturaData,
            tipoGasto: tipoGasto, // Usa el tipo recibido
            pagada: false,
            notas: '',
            categoria: '',
            archivoUrl: URL.createObjectURL(file),
            nombreArchivo: file.name,
            tipoArchivo: file.type
          };

          if (destino === 'bandeja') {
            setBandejaEntrada([...bandejaEntrada, nuevoGasto]);
            alert('‚úÖ Factura procesada y agregada a la bandeja');
          } else {
            setGastos([...gastos, { ...nuevoGasto, cliente: clienteActual, proyecto: proyectoActual }]);
            const tipoTexto = tipoGasto === 'cliente' ? 'Gasto del Cliente' : 'Costo Propio';
            alert(`‚úÖ Factura procesada como ${tipoTexto}`);
          }
        } catch (error) {
          console.error("Error:", error);
          if (error.message.includes("API Key")) {
            alert("‚ùå " + error.message + "\n\nHaz clic en el √≠cono de configuraci√≥n ‚öôÔ∏è para actualizar tu API Key.");
            setShowSettings(true);
          } else {
            alert("‚ùå Error al procesar. Verifica tu conexi√≥n o usa ingreso manual.");
          }
        } finally {
          setIsProcessing(false);
        }
      };

      const handleFileUpload = (e) => {
        if (e.target.files && e.target.files.length > 0) {
          Array.from(e.target.files).forEach(f => procesarFactura(f, 'asignada', 'cliente'));
        }
      };

      const handleFilePropioUpload = (e) => {
        if (e.target.files && e.target.files.length > 0) {
          Array.from(e.target.files).forEach(f => procesarFactura(f, 'asignada', 'propio'));
        }
      };

      const handleInboxUpload = (e) => {
        if (e.target.files && e.target.files.length > 0) {
          Array.from(e.target.files).forEach(f => procesarFactura(f, 'bandeja', 'cliente'));
        }
      };

      const asignarGastoBandeja = (gastoId, clienteId, proyecto) => {
        const gasto = bandejaEntrada.find(g => g.id === gastoId);
        if (gasto) {
          setGastos([...gastos, { ...gasto, cliente: clienteId, proyecto: proyecto }]);
          setBandejaEntrada(bandejaEntrada.filter(g => g.id !== gastoId));
        }
      };

      const eliminarDeBandeja = (id) => {
        if (confirm('¬øEliminar?')) setBandejaEntrada(bandejaEntrada.filter(g => g.id !== id));
      };

      const agregarGastoManual = (tipoGasto) => {
        const nuevoGasto = {
          id: Date.now(),
          cliente: clienteActual,
          proyecto: proyectoActual,
          tipoGasto: tipoGasto, // 'cliente' o 'propio'
          tienda: '',
          fecha: new Date().toISOString().split('T')[0],
          total: 0,
          items: [],
          numeroFactura: '',
          pagada: false,
          notas: '',
          categoria: ''
        };
        setGastos([...gastos, nuevoGasto]);
      };

      const actualizarGasto = (id, campo, valor) => {
        setGastos(gastos.map(g => g.id === id ? { ...g, [campo]: valor } : g));
      };

      const eliminarGasto = (id) => {
        if (confirm('¬øEliminar este gasto?')) {
          setGastos(gastos.filter(g => g.id !== id));
        }
      };

      const gastosCliente = gastos.filter(g => 
        g.cliente === clienteActual && (!proyectoActual || g.proyecto === proyectoActual)
      );

      const gastosDelCliente = gastosCliente.filter(g => g.tipoGasto === 'cliente');
      const gastosPropios = gastosCliente.filter(g => g.tipoGasto === 'propio');

      const totalGastosCliente = gastosDelCliente.reduce((sum, g) => sum + (parseFloat(g.total) || 0), 0);
      const totalGastosPropios = gastosPropios.reduce((sum, g) => sum + (parseFloat(g.total) || 0), 0);
      const totalGeneral = totalGastosCliente + totalGastosPropios;
      
      const gastosClientePendientes = gastosDelCliente.filter(g => !g.pagada);
      const totalPendiente = gastosClientePendientes.reduce((sum, g) => sum + (parseFloat(g.total) || 0), 0);


      const exportarAExcel = () => {
        const cliente = clientes.find(c => c.id === parseInt(clienteActual));
        
        let csv = 'Tipo,Tienda/Concepto,Fecha,Monto,Categor√≠a,Estado,Notas\n';
        
        gastosCliente.forEach(g => {
          const tipo = g.tipoGasto === 'cliente' ? 'Cliente' : 'Propio';
          const estado = g.tipoGasto === 'cliente' ? (g.pagada ? 'Pagada' : 'Pendiente') : 'N/A';
          csv += `"${tipo}","${g.tienda || ''}","${g.fecha}","${parseFloat(g.total || 0).toFixed(2)}","${g.categoria || ''}","${estado}","${(g.notas || '').replace(/"/g, '""')}"\n`;
        });
        
        csv += `\n"RESUMEN",,,,,,\n`;
        csv += `"Total Gastos Cliente",,,"${totalGastosCliente.toFixed(2)}",,,""
`;
        csv += `"Total Costos Propios",,,"${totalGastosPropios.toFixed(2)}",,,""
`;
        csv += `"Costo Total Proyecto",,,"${totalGeneral.toFixed(2)}",,,""
`;
        csv += `"Diferencia (Margen)",,,"${(totalGastosCliente - totalGastosPropios).toFixed(2)}",,,""
`;
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Gastos_${cliente?.nombre || 'Cliente'}_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        alert('‚úÖ Excel generado. Abre en Excel o s√∫belo a Google Sheets');
      };

      const generarReportePDF = () => {
        const cliente = clientes.find(c => c.id === parseInt(clienteActual));
        
        const html = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><style>
body { font-family: Arial, sans-serif; padding: 40px; color: #333; }
.header { border-bottom: 3px solid #2563eb; padding-bottom: 20px; margin-bottom: 30px; }
.header h1 { color: #2563eb; margin: 0 0 10px 0; font-size: 28px; }
.info-cliente { background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 25px; }
.resumen { background: #fef3c7; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #f59e0b; }
.resumen h2 { margin: 0 0 15px 0; color: #92400e; font-size: 20px; }
.resumen-item { display: flex; justify-content: space-between; margin: 8px 0; font-size: 16px; }
.total-pendiente { font-size: 24px; font-weight: bold; color: #dc2626; border-top: 2px solid #92400e; padding-top: 12px; margin-top: 12px; }
.costos-box { background: #e0f2fe; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #0284c7; }
.ganancia { background: #d1fae5; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #10b981; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
th { background: #2563eb; color: white; padding: 12px; text-align: left; font-weight: 600; }
td { padding: 12px; border-bottom: 1px solid #e5e7eb; }
tr:hover { background: #f9fafb; }
.pagada { color: #059669; font-weight: bold; }
.pendiente { color: #dc2626; font-weight: bold; }
.gasto-propio { background: #fef3c7; }
</style></head><body>
<div class="header">
  <h1>Reporte Completo - Proyecto ${proyectoActual || 'General'}</h1>
  <p style="margin: 5px 0; color: #6b7280;">Fecha: ${new Date().toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
</div>

${cliente ? `<div class="info-cliente">
  <h3>Cliente</h3>
  <p style="margin: 5px 0;"><strong>${cliente.nombre}</strong></p>
  ${cliente.email ? `<p style="margin: 5px 0;">Email: ${cliente.email}</p>` : ''}
  ${cliente.telefono ? `<p style="margin: 5px 0;">Tel√©fono: ${cliente.telefono}</p>` : ''}
  ${proyectoActual ? `<p style="margin: 5px 0;">Proyecto: <strong>${proyectoActual}</strong></p>` : ''}
</div>` : ''}

<div class="resumen">
  <h2>üí∞ Gastos del Cliente (Reembolsables)</h2>
  <div class="resumen-item">
    <span>Total a Cobrar al Cliente:</span>
    <span style="color: #059669; font-weight: 600;">$${totalGastosCliente.toFixed(2)}</span>
  </div>
  <div class="resumen-item">
    <span>Ya Pagado:</span>
    <span style="color: #059669; font-weight: 600;">$${(totalGastosCliente - totalPendiente).toFixed(2)}</span>
  </div>
  <div class="resumen-item total-pendiente">
    <span>PENDIENTE DE COBRO:</span>
    <span>$${totalPendiente.toFixed(2)}</span>
  </div>
</div>

<div class="costos-box">
  <h2 style="color: #0369a1; margin: 0 0 15px 0;">üîß Tus Costos del Proyecto</h2>
  <div class="resumen-item">
    <span>Total de Costos Propios:</span>
    <span style="color: #0369a1; font-weight: 600; font-size: 20px;">$${totalGastosPropios.toFixed(2)}</span>
  </div>
</div>

<div class="ganancia">
  <h2 style="color: #047857; margin: 0 0 15px 0;">üìà An√°lisis de Rentabilidad</h2>
  <div class="resumen-item">
    <span>Costo Total del Proyecto:</span>
    <span style="font-weight: 600;">$${totalGeneral.toFixed(2)}</span>
  </div>
  <div class="resumen-item">
    <span>Gastos del Cliente:</span>
    <span>$${totalGastosCliente.toFixed(2)}</span>
  </div>
  <div class="resumen-item">
    <span>Tus Costos:</span>
    <span>$${totalGastosPropios.toFixed(2)}</span>
  </div>
  <div class="resumen-item" style="font-size: 20px; font-weight: bold; color: #047857; border-top: 2px solid #10b981; padding-top: 12px; margin-top: 12px;">
    <span>Diferencia (Gastos Cliente - Tus Costos):</span>
    <span>$${(totalGastosCliente - totalGastosPropios).toFixed(2)}</span>
  </div>
</div>

<h2 style="color: #1f2937; margin-bottom: 15px;">üìã Gastos del Cliente (Pendientes de Cobro)</h2>
<table>
  <thead><tr><th>Fecha</th><th>Tienda/Concepto</th><th>Categor√≠a</th><th>Monto</th><th>Estado</th></tr></thead>
  <tbody>
    ${gastosClientePendientes.map(g => `<tr>
      <td>${new Date(g.fecha).toLocaleDateString('es-ES')}</td>
      <td><strong>${g.tienda}</strong>${g.numeroFactura ? `<br><small>#${g.numeroFactura}</small>` : ''}${g.notas ? `<br><small style="font-style: italic;">${g.notas}</small>` : ''}</td>
      <td>${g.categoria || '-'}</td>
      <td style="font-weight: 600;">$${parseFloat(g.total || 0).toFixed(2)}</td>
      <td class="pendiente">PENDIENTE</td>
    </tr>`).join('')}
  </tbody>
</table>

${gastosDelCliente.filter(g => g.pagada).length > 0 ? `
<h2 style="color: #1f2937; margin-top: 40px; margin-bottom: 15px;">‚úÖ Gastos del Cliente (Ya Pagados)</h2>
<table>
  <thead><tr><th>Fecha</th><th>Tienda/Concepto</th><th>Categor√≠a</th><th>Monto</th><th>Estado</th></tr></thead>
  <tbody>
    ${gastosDelCliente.filter(g => g.pagada).map(g => `<tr>
      <td>${new Date(g.fecha).toLocaleDateString('es-ES')}</td>
      <td><strong>${g.tienda}</strong>${g.notas ? `<br><small style="font-style: italic;">${g.notas}</small>` : ''}</td>
      <td>${g.categoria || '-'}</td>
      <td style="font-weight: 600;">$${parseFloat(g.total || 0).toFixed(2)}</td>
      <td class="pagada">PAGADA</td>
    </tr>`).join('')}
  </tbody>
</table>` : ''}

<h2 style="color: #1f2937; margin-top: 40px; margin-bottom: 15px;">üîß Tus Costos del Proyecto</h2>
<table>
  <thead><tr><th>Fecha</th><th>Concepto</th><th>Categor√≠a</th><th>Monto</th></tr></thead>
  <tbody>
    ${gastosPropios.map(g => `<tr class="gasto-propio">
      <td>${new Date(g.fecha).toLocaleDateString('es-ES')}</td>
      <td><strong>${g.tienda || 'Costo Propio'}</strong>${g.notas ? `<br><small style="font-style: italic;">${g.notas}</small>` : ''}</td>
      <td>${g.categoria || '-'}</td>
      <td style="font-weight: 600;">$${parseFloat(g.total || 0).toFixed(2)}</td>
    </tr>`).join('')}
    <tr style="background: #0284c7; color: white; font-weight: bold;">
      <td colspan="3" style="text-align: right;">TOTAL COSTOS PROPIOS:</td>
      <td>$${totalGastosPropios.toFixed(2)}</td>
    </tr>
  </tbody>
</table>

<div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e5e7eb; text-align: center; color: #6b7280; font-size: 14px;">
  <p>Este reporte fue generado autom√°ticamente.</p>
</div>
</body></html>`;

        const blob = new Blob([html], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Reporte_Completo_${cliente?.nombre || 'Cliente'}_${new Date().toISOString().split('T')[0]}.html`;
        a.click();
        alert('‚úÖ Reporte generado. Abre el archivo y gu√°rdalo como PDF');
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="bg-white rounded-lg shadow-xl p-6 mb-6">
              <h1 className="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                <DollarSign />
                Gestor de Gastos PRO
              </h1>
              <p className="text-gray-600">Control total de gastos: cliente y propios</p>
              
              {/* Navegaci√≥n */}
              <div className="mt-4 flex gap-3 flex-wrap">
                <button
                  onClick={() => setVistaActual('gastos')}
                  className={`px-6 py-3 rounded-lg transition flex items-center gap-2 ${
                    vistaActual === 'gastos' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                  }`}
                >
                  <FileText size={20} />
                  Gastos
                </button>
                
                <button
                  onClick={() => setVistaActual('dashboard')}
                  className={`px-6 py-3 rounded-lg transition flex items-center gap-2 ${
                    vistaActual === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                  }`}
                >
                  <BarChart size={20} />
                  Dashboard
                </button>

                <button
                  onClick={() => setMostrarBandeja(!mostrarBandeja)}
                  className="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
                >
                  <Inbox size={20} />
                  Bandeja
                  {bandejaEntrada.length > 0 && (
                    <span className="bg-red-500 rounded-full px-2 py-1 text-xs font-bold">
                      {bandejaEntrada.length}
                    </span>
                  )}
                </button>
                
                <button
                  onClick={() => inboxCameraRef.current?.click()}
                  disabled={isProcessing}
                  className="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition flex items-center gap-2 disabled:bg-gray-400"
                >
                  <Camera size={20} />
                  {isProcessing ? 'Procesando...' : 'Tomar Foto'}
                </button>
                
                <button
                  onClick={() => inboxInputRef.current?.click()}
                  disabled={isProcessing}
                  className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition flex items-center gap-2 disabled:bg-gray-400"
                >
                  <Upload size={20} />
                  {isProcessing ? 'Procesando...' : 'Subir Archivo'}
                </button>

                <input ref={inboxCameraRef} type="file" accept="image/*" capture="environment" onChange={handleInboxUpload} className="hidden" />
                <input ref={inboxInputRef} type="file" accept="image/*,application/pdf" multiple onChange={handleInboxUpload} className="hidden" />
                
                <button
                  onClick={() => setShowSettings(true)}
                  className="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-2 ml-auto"
                  title="Configuraci√≥n de API Key"
                >
                  <Settings size={20} />
                  Configuraci√≥n
                </button>
              </div>
            </div>

            {/* Vista Dashboard */}
            {vistaActual === 'dashboard' && clienteActual && (
              <div className="space-y-6">
                {/* M√©tricas principales */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  <div className="bg-white rounded-lg shadow p-6">
                    <p className="text-gray-600 text-sm mb-2">üíµ Gastos del Cliente</p>
                    <p className="text-3xl font-bold text-green-600">${totalGastosCliente.toFixed(2)}</p>
                    <p className="text-xs text-gray-500 mt-1">Pendiente: ${totalPendiente.toFixed(2)}</p>
                  </div>
                  
                  <div className="bg-white rounded-lg shadow p-6">
                    <p className="text-gray-600 text-sm mb-2">üîß Tus Costos</p>
                    <p className="text-3xl font-bold text-blue-600">${totalGastosPropios.toFixed(2)}</p>
                    <p className="text-xs text-gray-500 mt-1">{gastosPropios.length} registros</p>
                  </div>
                  
                  <div className="bg-white rounded-lg shadow p-6">
                    <p className="text-gray-600 text-sm mb-2">üìä Costo Total</p>
                    <p className="text-3xl font-bold text-gray-800">${totalGeneral.toFixed(2)}</p>
                    <p className="text-xs text-gray-500 mt-1">{gastosCliente.length} gastos totales</p>
                  </div>
                  
                  <div className="bg-white rounded-lg shadow p-6">
                    <p className="text-gray-600 text-sm mb-2">üí∞ Diferencia</p>
                    <p className={`text-3xl font-bold ${(totalGastosCliente - totalGastosPropios) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                      ${(totalGastosCliente - totalGastosPropios).toFixed(2)}
                    </p>
                    <p className="text-xs text-gray-500 mt-1">Cliente - Costos</p>
                  </div>
                </div>

                {/* Gr√°fico visual simple */}
                <div className="bg-white rounded-lg shadow p-6">
                  <h3 className="text-xl font-semibold mb-4">Desglose de Gastos</h3>
                  <div className="space-y-4">
                    <div>
                      <div className="flex justify-between mb-2">
                        <span className="text-sm font-medium">Gastos del Cliente</span>
                        <span className="text-sm font-bold text-green-600">${totalGastosCliente.toFixed(2)}</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-4">
                        <div className="bg-green-500 h-4 rounded-full" style={{width: `${totalGeneral > 0 ? (totalGastosCliente / totalGeneral * 100) : 0}%`}}></div>
                      </div>
                    </div>
                    
                    <div>
                      <div className="flex justify-between mb-2">
                        <span className="text-sm font-medium">Tus Costos</span>
                        <span className="text-sm font-bold text-blue-600">${totalGastosPropios.toFixed(2)}</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-4">
                        <div className="bg-blue-500 h-4 rounded-full" style={{width: `${totalGeneral > 0 ? (totalGastosPropios / totalGeneral * 100) : 0}%`}}></div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Categor√≠as m√°s gastadas */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="bg-white rounded-lg shadow p-6">
                    <h3 className="text-lg font-semibold mb-4">Gastos del Cliente por Categor√≠a</h3>
                    <div className="space-y-2">
                      {Object.entries(
                        gastosDelCliente.reduce((acc, g) => {
                          const cat = g.categoria || 'Sin categor√≠a';
                          acc[cat] = (acc[cat] || 0) + parseFloat(g.total || 0);
                          return acc;
                        }, {})
                      ).sort((a, b) => b[1] - a[1]).map(([cat, total]) => (
                        <div key={cat} className="flex justify-between items-center py-2 border-b">
                          <span className="text-sm">{cat}</span>
                          <span className="font-semibold text-green-600">${total.toFixed(2)}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  <div className="bg-white rounded-lg shadow p-6">
                    <h3 className="text-lg font-semibold mb-4">Tus Costos por Categor√≠a</h3>
                    <div className="space-y-2">
                      {Object.entries(
                        gastosPropios.reduce((acc, g) => {
                          const cat = g.categoria || 'Sin categor√≠a';
                          acc[cat] = (acc[cat] || 0) + parseFloat(g.total || 0);
                          return acc;
                        }, {})
                      ).sort((a, b) => b[1] - a[1]).map(([cat, total]) => (
                        <div key={cat} className="flex justify-between items-center py-2 border-b">
                          <span className="text-sm">{cat}</span>
                          <span className="font-semibold text-blue-600">${total.toFixed(2)}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Bandeja de Entrada */}
            {mostrarBandeja && (
              <div className="bg-white rounded-lg shadow-md p-6 mb-6 border-2 border-indigo-500">
                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                  <Inbox />
                  Bandeja de Entrada
                </h2>
                {bandejaEntrada.length === 0 ? (
                  <p className="text-gray-500 text-center py-8">No hay facturas en bandeja</p>
                ) : (
                  <div className="space-y-4">
                    {bandejaEntrada.map(gasto => (
                      <div key={gasto.id} className="border-2 border-indigo-200 rounded-lg p-4 bg-indigo-50">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                          <div>
                            <p className="text-sm"><strong>Tienda:</strong> {gasto.tienda || 'N/A'}</p>
                            <p className="text-sm"><strong>Fecha:</strong> {gasto.fecha || 'N/A'}</p>
                            <p className="text-sm"><strong>Total:</strong> <span className="text-green-600 font-bold">${parseFloat(gasto.total || 0).toFixed(2)}</span></p>
                          </div>
                          <div>
                            {gasto.tipoArchivo?.includes('pdf') ? (
                              <div className="flex items-center gap-2 text-red-600">
                                <FileText size={40} />
                                <span className="text-sm">PDF</span>
                              </div>
                            ) : (
                              <img src={gasto.archivoUrl} alt="Factura" className="max-w-full h-32 object-cover rounded" />
                            )}
                          </div>
                        </div>
                        <div className="flex gap-2 items-end">
                          <select
                            onChange={(e) => {
                              if (e.target.value) {
                                const proyecto = prompt('Proyecto (opcional):');
                                asignarGastoBandeja(gasto.id, e.target.value, proyecto || '');
                              }
                            }}
                            className="flex-1 p-2 border rounded"
                            defaultValue=""
                          >
                            <option value="">Asignar a cliente...</option>
                            {clientes.map(c => <option key={c.id} value={c.id}>{c.nombre}</option>)}
                          </select>
                          <button onClick={() => eliminarDeBandeja(gasto.id)} className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Vista de Gastos */}
            {vistaActual === 'gastos' && (
              <>
                {/* Secci√≥n Cliente */}
                <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                  <h2 className="text-xl font-semibold mb-4">Informaci√≥n del Cliente</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label className="block text-sm font-medium mb-2">Cliente</label>
                      <select value={clienteActual} onChange={(e) => setClienteActual(e.target.value)} className="w-full p-2 border rounded-lg">
                        <option value="">Seleccionar...</option>
                        {clientes.map(c => <option key={c.id} value={c.id}>{c.nombre}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-2">Proyecto</label>
                      <input type="text" value={proyectoActual} onChange={(e) => setProyectoActual(e.target.value)} placeholder="Ej: Cocina, Ba√±o..." className="w-full p-2 border rounded-lg" />
                    </div>
                  </div>
                  <button onClick={() => setShowAddClient(true)} className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2">
                    <Plus size={20} />
                    Agregar Cliente
                  </button>
                  {showAddClient && (
                    <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                      <h3 className="font-semibold mb-3">Nuevo Cliente</h3>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                        <input type="text" placeholder="Nombre *" value={nuevoCliente.nombre} onChange={(e) => setNuevoCliente({...nuevoCliente, nombre: e.target.value})} className="p-2 border rounded-lg" />
                        <input type="email" placeholder="Email" value={nuevoCliente.email} onChange={(e) => setNuevoCliente({...nuevoCliente, email: e.target.value})} className="p-2 border rounded-lg" />
                        <input type="tel" placeholder="Tel√©fono" value={nuevoCliente.telefono} onChange={(e) => setNuevoCliente({...nuevoCliente, telefono: e.target.value})} className="p-2 border rounded-lg" />
                      </div>
                      <div className="flex gap-2">
                        <button onClick={agregarCliente} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Guardar</button>
                        <button onClick={() => setShowAddClient(false)} className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                      </div>
                    </div>
                  )}
                </div>

                {/* Agregar Gastos */}
                {clienteActual && (
                  <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 className="text-xl font-semibold mb-4">Agregar Gastos</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Gastos del Cliente */}
                      <div className="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                        <h3 className="font-semibold text-green-800 mb-3">üíµ Gastos del Cliente (Reembolsables)</h3>
                        <div className="flex flex-col gap-2">
                          <button onClick={() => cameraInputRef.current?.click()} disabled={isProcessing} className="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center justify-center gap-2 disabled:bg-gray-400">
                            <Camera size={18} />
                            {isProcessing ? 'Procesando...' : 'Tomar Foto'}
                          </button>
                          <button onClick={() => fileInputRef.current?.click()} disabled={isProcessing} className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 disabled:bg-gray-400">
                            <Upload size={18} />
                            {isProcessing ? 'Procesando...' : 'Subir Archivo'}
                          </button>
                          <button onClick={() => agregarGastoManual('cliente')} className="bg-green-700 text-white px-4 py-2 rounded-lg hover:bg-green-800 flex items-center justify-center gap-2">
                            <Edit2 size={18} />
                            Ingresar Manual
                          </button>
                          <input ref={cameraInputRef} type="file" accept="image/*" capture="environment" onChange={handleFileUpload} className="hidden" />
                          <input ref={fileInputRef} type="file" accept="image/*,application/pdf" multiple onChange={handleFileUpload} className="hidden" />
                        </div>
                      </div>

                      {/* Gastos Propios */}
                      <div className="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">
                        <h3 className="font-semibold text-blue-800 mb-3">üîß Tus Costos del Proyecto</h3>
                        <div className="flex flex-col gap-2">
                          <button onClick={() => cameraInputPropioRef.current?.click()} disabled={isProcessing} className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center justify-center gap-2 disabled:bg-gray-400">
                            <Camera size={18} />
                            {isProcessing ? 'Procesando...' : 'Tomar Foto'}
                          </button>
                          <button onClick={() => fileInputPropioRef.current?.click()} disabled={isProcessing} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 disabled:bg-gray-400">
                            <Upload size={18} />
                            {isProcessing ? 'Procesando...' : 'Subir Archivo'}
                          </button>
                          <button onClick={() => agregarGastoManual('propio')} className="bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 flex items-center justify-center gap-2">
                            <Plus size={18} />
                            Ingresar Manual
                          </button>
                          <input ref={cameraInputPropioRef} type="file" accept="image/*" capture="environment" onChange={handleFilePropioUpload} className="hidden" />
                          <input ref={fileInputPropioRef} type="file" accept="image/*,application/pdf" multiple onChange={handleFilePropioUpload} className="hidden" />
                          <p className="text-xs text-blue-700 mt-2">Ej: Combustible, herramientas, etc.</p>
                        </div>
                      </div>
                    </div>
                    {isProcessing && (
                      <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p className="text-blue-800 flex items-center gap-2">
                          <span className="animate-spin">‚öôÔ∏è</span>
                          Procesando factura con IA...
                        </p>
                      </div>
                    )}
                  </div>
                )}

                {/* Resumen */}
                {clienteActual && gastosCliente.length > 0 && (
                  <div className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg shadow-md p-6 mb-6 border-l-4 border-orange-500">
                    <h2 className="text-xl font-semibold mb-4">Resumen del Proyecto</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                      <div className="bg-white p-4 rounded-lg shadow">
                        <p className="text-gray-600 text-sm">Gastos del Cliente</p>
                        <p className="text-2xl font-bold text-green-600">${totalGastosCliente.toFixed(2)}</p>
                        <p className="text-xs text-gray-500">Pendiente: ${totalPendiente.toFixed(2)}</p>
                      </div>
                      <div className="bg-white p-4 rounded-lg shadow">
                        <p className="text-gray-600 text-sm">Tus Costos</p>
                        <p className="text-2xl font-bold text-blue-600">${totalGastosPropios.toFixed(2)}</p>
                      </div>
                      <div className="bg-white p-4 rounded-lg shadow">
                        <p className="text-gray-600 text-sm">Costo Total</p>
                        <p className="text-2xl font-bold text-gray-800">${totalGeneral.toFixed(2)}</p>
                      </div>
                      <div className="bg-white p-4 rounded-lg shadow">
                        <p className="text-gray-600 text-sm">Diferencia</p>
                        <p className={`text-2xl font-bold ${(totalGastosCliente - totalGastosPropios) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                          ${(totalGastosCliente - totalGastosPropios).toFixed(2)}
                        </p>
                      </div>
                    </div>
                    <div className="flex gap-3 flex-wrap mt-4">
                      <button onClick={generarReportePDF} className="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 flex items-center gap-2">
                        <Download size={20} />
                        Generar Reporte PDF
                      </button>
                      <button onClick={exportarAExcel} className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 flex items-center gap-2">
                        <Table size={20} />
                        Exportar a Excel
                      </button>
                    </div>
                  </div>
                )}

                {/* Lista de Gastos */}
                {clienteActual && (
                  <div className="space-y-6">
                    {/* Gastos del Cliente */}
                    {gastosDelCliente.length > 0 && (
                      <div className="bg-white rounded-lg shadow-md p-6">
                        <h2 className="text-xl font-semibold mb-4 text-green-800">üíµ Gastos del Cliente</h2>
                        <div className="space-y-4">
                          {gastosDelCliente.map(gasto => (
                            <div key={gasto.id} className="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                  <label className="text-xs text-gray-500">Tienda</label>
                                  <input type="text" value={gasto.tienda} onChange={(e) => actualizarGasto(gasto.id, 'tienda', e.target.value)} className="w-full p-2 border rounded mt-1" placeholder="Home Depot" />
                                </div>
                                <div>
                                  <label className="text-xs text-gray-500">Fecha</label>
                                  <input type="date" value={gasto.fecha} onChange={(e) => actualizarGasto(gasto.id, 'fecha', e.target.value)} className="w-full p-2 border rounded mt-1" />
                                </div>
                                <div>
                                  <label className="text-xs text-gray-500">Total ($)</label>
                                  <input type="number" step="0.01" value={gasto.total} onChange={(e) => actualizarGasto(gasto.id, 'total', e.target.value)} className="w-full p-2 border rounded mt-1" />
                                </div>
                                <div>
                                  <label className="text-xs text-gray-500">Categor√≠a</label>
                                  <select value={gasto.categoria} onChange={(e) => actualizarGasto(gasto.id, 'categoria', e.target.value)} className="w-full p-2 border rounded mt-1">
                                    <option value="">Seleccionar...</option>
                                    {CATEGORIAS_CLIENTE.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                  </select>
                                </div>
                              </div>
                              <div className="mt-3">
                                <label className="text-xs text-gray-500">Notas</label>
                                <textarea value={gasto.notas} onChange={(e) => actualizarGasto(gasto.id, 'notas', e.target.value)} className="w-full p-2 border rounded mt-1" rows="2" />
                              </div>
                              <div className="mt-4 flex gap-2">
                                <button onClick={() => actualizarGasto(gasto.id, 'pagada', !gasto.pagada)} className={`px-4 py-2 rounded-lg flex items-center gap-2 ${gasto.pagada ? 'bg-green-600 text-white' : 'bg-red-100 text-red-700'}`}>
                                  {gasto.pagada ? <Check size={18} /> : <X size={18} />}
                                  {gasto.pagada ? 'PAGADA' : 'PENDIENTE'}
                                </button>
                                <button onClick={() => eliminarGasto(gasto.id)} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 flex items-center gap-2">
                                  <Trash2 size={18} />
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {/* Gastos Propios */}
                    {gastosPropios.length > 0 && (
                      <div className="bg-white rounded-lg shadow-md p-6">
                        <h2 className="text-xl font-semibold mb-4 text-blue-800">üîß Tus Costos del Proyecto</h2>
                        <div className="space-y-4">
                          {gastosPropios.map(gasto => (
                            <div key={gasto.id} className="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">
                              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                  <label className="text-xs text-gray-500">Concepto</label>
                                  <input type="text" value={gasto.tienda} onChange={(e) => actualizarGasto(gasto.id, 'tienda', e.target.value)} className="w-full p-2 border rounded mt-1" placeholder="Ej: Mano de obra" />
                                </div>
                                <div>
                                  <label className="text-xs text-gray-500">Fecha</label>
                                  <input type="date" value={gasto.fecha} onChange={(e) => actualizarGasto(gasto.id, 'fecha', e.target.value)} className="w-full p-2 border rounded mt-1" />
                                </div>
                                <div>
                                  <label className="text-xs text-gray-500">Total ($)</label>
                                  <input type="number" step="0.01" value={gasto.total} onChange={(e) => actualizarGasto(gasto.id, 'total', e.target.value)} className="w-full p-2 border rounded mt-1" />
                                </div>
                                <div>
                                  <label className="text-xs text-gray-500">Categor√≠a</label>
                                  <select value={gasto.categoria} onChange={(e) => actualizarGasto(gasto.id, 'categoria', e.target.value)} className="w-full p-2 border rounded mt-1">
                                    <option value="">Seleccionar...</option>
                                    {CATEGORIAS_PROPIAS.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                  </select>
                                </div>
                              </div>
                              <div className="mt-3">
                                <label className="text-xs text-gray-500">Notas</label>
                                <textarea value={gasto.notas} onChange={(e) => actualizarGasto(gasto.id, 'notas', e.target.value)} className="w-full p-2 border rounded mt-1" rows="2" />
                              </div>
                              <div className="mt-4">
                                <button onClick={() => eliminarGasto(gasto.id)} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 flex items-center gap-2">
                                  <Trash2 size={18} />
                                  Eliminar
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {gastosCliente.length === 0 && (
                      <p className="text-gray-500 text-center py-8">No hay gastos registrados para este cliente/proyecto</p>
                    )}
                  </div>
                )}

                {!clienteActual && (
                  <div className="bg-white rounded-lg shadow-md p-12 text-center">
                    <FileText size={64} className="mx-auto text-gray-300 mb-4" />
                    <h3 className="text-xl text-gray-600 mb-2">Selecciona o agrega un cliente para comenzar</h3>
                  </div>
                )}
              </>
            )}

            {/* Modal de Configuraci√≥n */}
            {showSettings && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg shadow-2xl max-w-md w-full p-6">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-bold text-gray-800">‚öôÔ∏è Configuraci√≥n</h2>
                    <button onClick={() => setShowSettings(false)} className="text-gray-500 hover:text-gray-700">
                      <X size={24} />
                    </button>
                  </div>
                  
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      API Key de Claude
                    </label>
                    <input
                      type="password"
                      value={tempApiKey || apiKey}
                      onChange={(e) => setTempApiKey(e.target.value)}
                      placeholder="sk-ant-..."
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                    <p className="text-xs text-gray-500 mt-2">
                      Tu API Key se guarda de forma segura en tu navegador. 
                      <a href="https://console.anthropic.com/settings/keys" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline ml-1">
                        Obtener API Key ‚Üí
                      </a>
                    </p>
                  </div>

                  <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                    <h3 className="font-semibold text-blue-900 mb-2">‚ÑπÔ∏è ¬øC√≥mo obtener tu API Key?</h3>
                    <ol className="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                      <li>Ve a console.anthropic.com</li>
                      <li>Crea cuenta o inicia sesi√≥n</li>
                      <li>Ve a "API Keys" en el men√∫</li>
                      <li>Clic en "Create Key"</li>
                      <li>Copia la key y p√©gala aqu√≠</li>
                    </ol>
                  </div>

                  {apiKey && (
                    <div className="mb-4 p-3 bg-green-50 rounded-lg">
                      <p className="text-sm text-green-800">
                        ‚úÖ API Key configurada correctamente
                      </p>
                    </div>
                  )}

                  <div className="flex gap-3">
                    <button
                      onClick={guardarApiKey}
                      className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold"
                    >
                      Guardar
                    </button>
                    {apiKey && (
                      <button
                        onClick={eliminarApiKey}
                        className="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-semibold"
                      >
                        Eliminar
                      </button>
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GestorGastosPRO />);
  </script>
</body>
</html>